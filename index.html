<!DOCTYPE html><html lang="zh-TW"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>å®¢è¨´è™•ç†ç³»çµ± - é›²ç«¯ç‰ˆ</title>    <style>        * {            margin: 0;            padding: 0;            box-sizing: border-box;        }        body {            font-family: 'Microsoft JhengHei', Arial, sans-serif;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            min-height: 100vh;            padding: 20px;        }        .container {            max-width: 1200px;            margin: 0 auto;        }        .header {            text-align: center;            margin-bottom: 30px;            color: white;        }        .header h1 {            font-size: 2.5rem;            margin-bottom: 10px;            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);        }        .nav-tabs {            display: flex;            background: white;            border-radius: 15px 15px 0 0;            box-shadow: 0 4px 20px rgba(0,0,0,0.1);            overflow: hidden;        }        .nav-tab {            flex: 1;            padding: 15px 20px;            text-align: center;            cursor: pointer;            background: #f8f9fa;            border: none;            font-size: 16px;            font-weight: bold;            color: #6c757d;            transition: all 0.3s ease;        }        .nav-tab.active {            background: linear-gradient(135deg, #667eea, #764ba2);            color: white;        }        .nav-tab:hover:not(.active) {            background: #e9ecef;        }        .tab-content {            background: white;            border-radius: 0 0 15px 15px;            box-shadow: 0 4px 20px rgba(0,0,0,0.1);            min-height: 500px;            display: none;        }        .tab-content.active {            display: block;        }        .form-container, .admin-container {            padding: 30px;        }        .form-group {            margin-bottom: 25px;        }        .form-group label {            display: block;            margin-bottom: 8px;            font-weight: bold;            color: #333;        }        .form-control {            width: 100%;            padding: 12px;            border: 2px solid #e9ecef;            border-radius: 8px;            font-size: 16px;            transition: all 0.3s ease;        }        .form-control:focus {            border-color: #667eea;            outline: none;            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);        }        textarea.form-control {            resize: vertical;            min-height: 120px;        }        .file-upload-area {            border: 2px dashed #667eea;            border-radius: 8px;            padding: 30px;            text-align: center;            background: #f8f9ff;            transition: all 0.3s ease;            cursor: pointer;        }        .file-upload-area:hover {            background: #f0f4ff;        }        .file-upload-area.dragover {            border-color: #4c63d2;            background: #e8efff;        }        .upload-icon {            font-size: 48px;            color: #667eea;            margin-bottom: 15px;        }        .btn {            padding: 12px 30px;            border: none;            border-radius: 8px;            font-size: 16px;            font-weight: bold;            cursor: pointer;            transition: all 0.3s ease;            margin: 5px;        }        .btn-primary {            background: linear-gradient(135deg, #667eea, #764ba2);            color: white;        }        .btn-primary:hover {            transform: translateY(-2px);            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);        }        .btn-success {            background: linear-gradient(135deg, #00b894, #00a085);            color: white;        }        .btn-warning {            background: linear-gradient(135deg, #fdcb6e, #e17055);            color: white;        }        .btn-danger {            background: linear-gradient(135deg, #ff6b6b, #ee5a52);            color: white;        }        .btn-info {            background: linear-gradient(135deg, #74b9ff, #0984e3);            color: white;        }        .complaint-list {            display: grid;            gap: 20px;        }        .complaint-item {            background: #f8f9fa;            border: 1px solid #dee2e6;            border-radius: 10px;            padding: 20px;            transition: all 0.3s ease;        }        .complaint-item:hover {            transform: translateY(-2px);            box-shadow: 0 5px 15px rgba(0,0,0,0.1);        }        .complaint-header {            display: flex;            justify-content: space-between;            align-items: center;            margin-bottom: 15px;            flex-wrap: wrap;        }        .complaint-id {            font-weight: bold;            color: #667eea;            font-size: 18px;        }        .complaint-date {            color: #6c757d;            font-size: 14px;        }        .status-badge {            padding: 4px 12px;            border-radius: 20px;            font-size: 12px;            font-weight: bold;            margin-left: auto;        }        .status-pending {            background: #ffeaa7;            color: #d63031;        }        .status-processing {            background: #74b9ff;            color: white;        }        .status-resolved {            background: #00b894;            color: white;        }        .complaint-content {            display: grid;            grid-template-columns: 1fr 1fr;            gap: 15px;            margin-bottom: 15px;        }        .complaint-field {            background: white;            padding: 10px;            border-radius: 5px;            border-left: 4px solid #667eea;        }        .field-label {            font-weight: bold;            color: #333;            font-size: 14px;            margin-bottom: 5px;        }        .field-value {            color: #666;        }        .image-preview {            display: flex;            gap: 10px;            flex-wrap: wrap;            margin-top: 10px;        }        .image-preview img {            width: 100px;            height: 100px;            object-fit: cover;            border-radius: 5px;            border: 2px solid #dee2e6;        }        .complaint-actions {            display: flex;            gap: 10px;            justify-content: flex-end;            flex-wrap: wrap;        }        .success-message, .error-message, .info-message {            padding: 15px;            border-radius: 8px;            margin-bottom: 20px;            display: none;        }        .success-message {            background: #d4edda;            border: 1px solid #c3e6cb;            color: #155724;        }        .error-message {            background: #f8d7da;            border: 1px solid #f5c6cb;            color: #721c24;        }        .info-message {            background: #d1ecf1;            border: 1px solid #bee5eb;            color: #0c5460;        }        .stats-grid {            display: grid;            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));            gap: 20px;            margin-bottom: 30px;        }        .stat-card {            background: linear-gradient(135deg, #667eea, #764ba2);            color: white;            padding: 20px;            border-radius: 10px;            text-align: center;        }        .stat-number {            font-size: 2rem;            font-weight: bold;            margin-bottom: 5px;        }        .stat-label {            font-size: 14px;            opacity: 0.9;        }        .config-section {            background: #f8f9fa;            border: 1px solid #dee2e6;            border-radius: 10px;            padding: 20px;            margin-bottom: 30px;        }        .config-section h3 {            color: #333;            margin-bottom: 20px;            border-bottom: 2px solid #667eea;            padding-bottom: 10px;        }        .type-list {            display: grid;            gap: 10px;            margin-bottom: 20px;        }        .type-item {            display: flex;            justify-content: space-between;            align-items: center;            background: white;            padding: 10px 15px;            border-radius: 5px;            border: 1px solid #dee2e6;        }        .loading-overlay {            position: fixed;            top: 0;            left: 0;            right: 0;            bottom: 0;            background: rgba(0,0,0,0.5);            display: none;            justify-content: center;            align-items: center;            z-index: 9999;        }        .loading-spinner {            background: white;            padding: 30px;            border-radius: 10px;            text-align: center;        }        .spinner {            border: 4px solid #f3f3f3;            border-top: 4px solid #667eea;            border-radius: 50%;            width: 50px;            height: 50px;            animation: spin 1s linear infinite;            margin: 0 auto 20px;        }        @keyframes spin {            0% { transform: rotate(0deg); }            100% { transform: rotate(360deg); }        }        .setup-guide {            background: #fff3cd;            border: 1px solid #ffeaa7;            color: #856404;            padding: 20px;            border-radius: 10px;            margin-bottom: 20px;        }        @media (max-width: 768px) {            .complaint-content {                grid-template-columns: 1fr;            }                        .nav-tab {                padding: 12px 15px;                font-size: 14px;            }                        .header h1 {                font-size: 2rem;            }            .complaint-actions {                justify-content: center;            }        }    </style>    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script></head><body>    <div class="loading-overlay" id="loading-overlay">        <div class="loading-spinner">            <div class="spinner"></div>            <p>è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</p>        </div>    </div>    <div class="container">        <div class="header">            <h1>ğŸš— å®¢è¨´è™•ç†ç³»çµ± - é›²ç«¯ç‰ˆ</h1>            <p>å°ˆæ¥­çš„å®¢æˆ¶æœå‹™ç®¡ç†å¹³å°</p>        </div>        <div class="nav-tabs">            <button class="nav-tab active" onclick="switchTab('customer')">å®¢æˆ¶ç”³è¨´</button>            <button class="nav-tab" onclick="switchTab('admin')">å¾Œå°ç®¡ç†</button>        </div>        <div id="customer-tab" class="tab-content active">            <div class="form-container">                <div id="customer-success-message" class="success-message">                    âœ… æ‚¨çš„å®¢è¨´å·²æˆåŠŸæäº¤è‡³é›²ç«¯ï¼æˆ‘å€‘æœƒç›¡å¿«è™•ç†ä¸¦å›è¦†æ‚¨ã€‚                </div>                <div id="customer-error-message" class="error-message">                    âŒ æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚                </div>                <form id="complaint-form">                    <div class="form-group">                        <label for="customer-name">å®¢æˆ¶å§“å *</label>                        <input type="text" id="customer-name" class="form-control" required>                    </div>                    <div class="form-group">                        <label for="customer-phone">è¯çµ¡é›»è©± *</label>                        <input type="tel" id="customer-phone" class="form-control" required>                    </div>                    <div class="form-group">                        <label for="customer-email">é›»å­ä¿¡ç®±</label>                        <input type="email" id="customer-email" class="form-control">                    </div>                    <div class="form-group">                        <label for="license-plate">è»Šç‰Œè™Ÿç¢¼ *</label>                        <input type="text" id="license-plate" class="form-control" placeholder="ä¾‹ï¼šABC-1234" required>                    </div>                    <div class="form-group">                        <label for="complaint-type">å®¢è¨´é¡å‹ *</label>                        <select id="complaint-type" class="form-control" required>                            <option value="">è«‹é¸æ“‡å®¢è¨´é¡å‹</option>                            </select>                    </div>                    <div class="form-group">                        <label for="incident-date">äº‹ç™¼æ—¥æœŸ *</label>                        <input type="date" id="incident-date" class="form-control" required>                    </div>                    <div class="form-group">                        <label for="description">å•é¡Œæè¿° *</label>                        <textarea id="description" class="form-control" placeholder="è«‹è©³ç´°æè¿°æ‚¨é‡åˆ°çš„å•é¡Œ..." required></textarea>                    </div>                    <div class="form-group">                        <label>ä¸Šå‚³ç›¸é—œç…§ç‰‡</label>                        <div class="file-upload-area" onclick="document.getElementById('photo-upload').click()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">                            <div class="upload-icon">ğŸ“·</div>                            <p><strong>é»æ“Šä¸Šå‚³</strong> æˆ– <strong>æ‹–æ‹½ç…§ç‰‡è‡³æ­¤</strong></p>                            <p style="font-size: 14px; color: #666; margin-top: 10px;">æ”¯æ´ JPG, PNG æ ¼å¼ï¼Œæœ€å¤§ 5MB</p>                            <input type="file" id="photo-upload" multiple accept="image/*" style="display: none;" onchange="handleFileSelect(event)">                        </div>                        <div id="image-preview" class="image-preview"></div>                    </div>                    <button type="submit" class="btn btn-primary">â˜ï¸ æäº¤å®¢è¨´è‡³é›²ç«¯</button>                </form>            </div>        </div>        <div id="admin-tab" class="tab-content">            <div id="login-container" class="admin-container">                <div style="max-width: 400px; margin: 50px auto; text-align: center;">                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">                        <h2 style="margin-bottom: 10px;">ğŸ” ç®¡ç†å“¡ç™»å…¥</h2>                        <p>è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼ä»¥å­˜å–å¾Œå°ç®¡ç†</p>                    </div>                                        <div id="login-error" class="error-message">                        å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥                    </div>                                        <form id="login-form" style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">                        <div class="form-group">                            <label for="admin-username">ç®¡ç†å“¡å¸³è™Ÿ</label>                            <input type="text" id="admin-username" class="form-control" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ" required>                        </div>                        <div class="form-group">                            <label for="admin-password">å¯†ç¢¼</label>                            <input type="password" id="admin-password" class="form-control" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>                        </div>                        <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å…¥</button>                    </form>                                        <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 5px; font-size: 14px;">                        <strong>æ¸¬è©¦å¸³è™Ÿï¼š</strong><br>                        å¸³è™Ÿï¼šadmin<br>                        å¯†ç¢¼ï¼š123456                    </div>                </div>            </div>            <div id="admin-dashboard" class="admin-container" style="display: none;">                <div class="setup-guide">                    <h3>âš™ï¸ Google Sheets API è¨­å®š</h3>                    <p><strong>é‡è¦ï¼š</strong>ä½¿ç”¨é›²ç«¯åŠŸèƒ½å‰ï¼Œè«‹å…ˆè¨­å®š Google Sheets API é‡‘é‘°ï¼š</p>                    <div class="form-group" style="margin-top: 15px;">                        <label for="api-key">Google Sheets API é‡‘é‘°</label>                        <input type="text" id="api-key" class="form-control" placeholder="è«‹è¼¸å…¥æ‚¨çš„ API é‡‘é‘°">                    </div>                    <div class="form-group">                        <label for="sheet-id">Google è©¦ç®—è¡¨ ID</label>                        <input type="text" id="sheet-id" class="form-control" placeholder="è«‹è¼¸å…¥è©¦ç®—è¡¨ ID">                    </div>                    <button class="btn btn-info" onclick="saveGoogleSheetsConfig()">ğŸ’¾ å„²å­˜è¨­å®š</button>                    <button class="btn btn-success" onclick="initializeSheet()">ğŸš€ åˆå§‹åŒ–è©¦ç®—è¡¨</button>                </div>                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap;">                    <h2 style="color: #333;">ğŸ“Š å¾Œå°ç®¡ç†ç³»çµ±</h2>                    <div>                        <button class="btn btn-success" onclick="exportToCSV()">ğŸ“Š åŒ¯å‡º CSV</button>                        <button class="btn btn-info" onclick="syncFromCloud()">â˜ï¸ åŒæ­¥é›²ç«¯è³‡æ–™</button>                        <button class="btn btn-danger" onclick="logout()">ç™»å‡º</button>                    </div>                </div>                <div class="stats-grid">                    <div class="stat-card">                        <div class="stat-number" id="total-complaints">0</div>                        <div class="stat-label">ç¸½å®¢è¨´æ•¸</div>                    </div>                    <div class="stat-card">                        <div class="stat-number" id="pending-complaints">0</div>                        <div class="stat-label">å¾…è™•ç†</div>                    </div>                    <div class="stat-card">                        <div class="stat-number" id="processing-complaints">0</div>                        <div class="stat-label">è™•ç†ä¸­</div>                    </div>                    <div class="stat-card">                        <div class="stat-number" id="resolved-complaints">0</div>                        <div class="stat-label">å·²è§£æ±º</div>                    </div>                </div>                <div class="config-section">                    <h3>ğŸ·ï¸ å®¢è¨´é¡å‹ç®¡ç†</h3>                    <div class="type-list" id="complaint-types-list">                        </div>                    <div style="display: flex; gap: 10px; align-items: end;">                        <div class="form-group" style="flex: 1; margin-bottom: 0;">                            <label for="new-type-value">é¡å‹ä»£ç¢¼</label>                            <input type="text" id="new-type-value" class="form-control" placeholder="ä¾‹ï¼šwarranty">                        </div>                        <div class="form-group" style="flex: 2; margin-bottom: 0;">                            <label for="new-type-label">é¡¯ç¤ºåç¨±</label>                            <input type="text" id="new-type-label" class="form-control" placeholder="ä¾‹ï¼šä¿å›ºç›¸é—œå•é¡Œ">                        </div>                        <button class="btn btn-success" onclick="addComplaintType()">â• æ–°å¢é¡å‹</button>                    </div>                </div>                <h3 style="margin-bottom: 20px; color: #333;">å®¢è¨´è¨˜éŒ„åˆ—è¡¨</h3>                <div id="admin-info-message" class="info-message">                    ğŸ’¡ å¾é›²ç«¯åŒæ­¥è³‡æ–™æˆ–ç­‰å¾…å®¢æˆ¶æäº¤æ–°ç”³è¨´                </div>                <div id="complaint-list" class="complaint-list">                    </div>            </div>        </div>    </div>    <script>        // å…¨åŸŸè®Šæ•¸        let complaints = JSON.parse(localStorage.getItem('complaints_backup')) || [];        let complaintIdCounter = parseInt(localStorage.getItem('complaintIdCounter')) || 1;        let isAdminLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';        let complaintTypes = JSON.parse(localStorage.getItem('complaintTypes')) || [            { value: 'service', label: 'æœå‹™å“è³ªå•é¡Œ' },            { value: 'damage', label: 'è»Šè¼›æå£' },            { value: 'billing', label: 'è¨ˆè²»çˆ­è­°' },            { value: 'staff', label: 'å“¡å·¥æœå‹™æ…‹åº¦' },            { value: 'facility', label: 'è¨­æ–½è¨­å‚™å•é¡Œ' },            { value: 'safety', label: 'å®‰å…¨ç›¸é—œå•é¡Œ' },            { value: 'appointment', label: 'é ç´„æ’ç¨‹å•é¡Œ' },            { value: 'refund', label: 'é€€æ¬¾ç›¸é—œ' },            { value: 'other', label: 'å…¶ä»–å•é¡Œ' }        ];        // Google Sheets è¨­å®š        let googleSheetsConfig = JSON.parse(localStorage.getItem('googleSheetsConfig')) || {            apiKey: '',            sheetId: ''        };        // ç®¡ç†å“¡å¸³è™Ÿè¨­å®š        const adminCredentials = {            username: 'admin',            password: '123456'        };        // åˆå§‹åŒ–        document.addEventListener('DOMContentLoaded', function() {            checkAdminLogin();            loadComplaintTypes();            updateComplaintTypesList();            loadComplaintList();            updateStats();                        // è¼‰å…¥ Google Sheets è¨­å®š            if (googleSheetsConfig.apiKey && googleSheetsConfig.sheetId) {                document.getElementById('api-key').value = googleSheetsConfig.apiKey;                document.getElementById('sheet-id').value = googleSheetsConfig.sheetId;            }                        // ç™»å…¥è¡¨å–®äº‹ä»¶            const loginForm = document.getElementById('login-form');            if (loginForm) {                loginForm.addEventListener('submit', handleLogin);            }                        const complaintForm = document.getElementById('complaint-form');            if (complaintForm) {                complaintForm.addEventListener('submit', handleComplaintSubmit);            }        });        // é¡¯ç¤ºè¼‰å…¥å‹•ç•«        function showLoading() {            document.getElementById('loading-overlay').style.display = 'flex';        }        // éš±è—è¼‰å…¥å‹•ç•«        function hideLoading() {            document.getElementById('loading-overlay').style.display = 'none';        }        // åˆ‡æ›é ç±¤        function switchTab(tabName) {            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));                        event.target.classList.add('active');            document.getElementById(tabName + '-tab').classList.add('active');                        if (tabName === 'admin') {                checkAdminLogin();                if (isAdminLoggedIn) {                    loadComplaintList();                    updateStats();                    updateComplaintTypesList();                }            } else if (tabName === 'customer') {                loadComplaintTypes();            }        }        // è¼‰å…¥å®¢è¨´é¡å‹åˆ°ä¸‹æ‹‰é¸å–®        function loadComplaintTypes() {            const select = document.getElementById('complaint-type');            select.innerHTML = '<option value="">è«‹é¸æ“‡å®¢è¨´é¡å‹</option>';                        complaintTypes.forEach(type => {                const option = document.createElement('option');                option.value = type.value;                option.textContent = type.label;                select.appendChild(option);            });        }        // æ›´æ–°å¾Œå°çš„å®¢è¨´é¡å‹åˆ—è¡¨        function updateComplaintTypesList() {            if (!isAdminLoggedIn) return;                        const list = document.getElementById('complaint-types-list');            list.innerHTML = '';                        complaintTypes.forEach((type, index) => {                const item = document.createElement('div');                item.className = 'type-item';                item.innerHTML = `                    <div>                        <strong>${type.value}</strong> - ${type.label}                    </div>                    <button class="btn btn-danger" onclick="removeComplaintType(${index})" style="padding: 5px 10px; margin: 0;">ğŸ—‘ï¸</button>                `;                list.appendChild(item);            });        }        // æ–°å¢å®¢è¨´é¡å‹        function addComplaintType() {            const value = document.getElementById('new-type-value').value.trim();            const label = document.getElementById('new-type-label').value.trim();                        if (!value || !label) {                alert('è«‹å¡«å¯«å®Œæ•´çš„é¡å‹ä»£ç¢¼å’Œé¡¯ç¤ºåç¨±');                return;            }                        // æª¢æŸ¥æ˜¯å¦é‡è¤‡            if (complaintTypes.find(type => type.value === value)) {                alert('é¡å‹ä»£ç¢¼å·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨å…¶ä»–ä»£ç¢¼');                return;            }                        complaintTypes.push({ value, label });            localStorage.setItem('complaintTypes', JSON.stringify(complaintTypes));                        // æ¸…ç©ºè¼¸å…¥æ¡†            document.getElementById('new-type-value').value = '';            document.getElementById('new-type-label').value = '';                        // æ›´æ–°é¡¯ç¤º            updateComplaintTypesList();            loadComplaintTypes();        }        // åˆªé™¤å®¢è¨´é¡å‹        function removeComplaintType(index) {            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å®¢è¨´é¡å‹å—ï¼Ÿ')) {                complaintTypes.splice(index, 1);                localStorage.setItem('complaintTypes', JSON.stringify(complaintTypes));                updateComplaintTypesList();                loadComplaintTypes();            }        }        // å„²å­˜ Google Sheets è¨­å®š        function saveGoogleSheetsConfig() {            const apiKey = document.getElementById('api-key').value.trim();            const sheetId = document.getElementById('sheet-id').value.trim();                        if (!apiKey || !sheetId) {                alert('è«‹å¡«å¯«å®Œæ•´çš„ API é‡‘é‘°å’Œè©¦ç®—è¡¨ ID');                return;            }                        googleSheetsConfig = { apiKey, sheetId };            localStorage.setItem('googleSheetsConfig', JSON.stringify(googleSheetsConfig));                        showMessage('success', 'âœ… Google Sheets è¨­å®šå·²å„²å­˜ï¼');        }        // åˆå§‹åŒ– Google Sheets        async function initializeSheet() {            if (!googleSheetsConfig.apiKey || !googleSheetsConfig.sheetId) {                alert('è«‹å…ˆè¨­å®š API é‡‘é‘°å’Œè©¦ç®—è¡¨ ID');                return;            }                        showLoading();                        try {                // è¨­å®šæ¨™é¡Œåˆ—                const headers = [                    'å®¢è¨´ç·¨è™Ÿ', 'æäº¤æ™‚é–“', 'å®¢æˆ¶å§“å', 'è¯çµ¡é›»è©±', 'é›»å­ä¿¡ç®±',                     'è»Šç‰Œè™Ÿç¢¼', 'å®¢è¨´é¡å‹', 'äº‹ç™¼æ—¥æœŸ', 'å•é¡Œæè¿°', 'è™•ç†ç‹€æ…‹', 'ç…§ç‰‡æ•¸é‡'                ];                                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${googleSheetsConfig.sheetId}/values/A1:K1?key=${googleSheetsConfig.apiKey}`, {                    method: 'PUT',                    headers: {                        'Content-Type': 'application/json'                    },                    body: JSON.stringify({                        values: [headers]                    })                });                                if (response.ok) {                    showMessage('success', 'âœ… Google Sheets åˆå§‹åŒ–æˆåŠŸï¼');                } else {                    throw new Error('åˆå§‹åŒ–å¤±æ•—');                }            } catch (error) {                console.error('åˆå§‹åŒ–éŒ¯èª¤:', error);                showMessage('error', 'âŒ åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API é‡‘é‘°å’Œè©¦ç®—è¡¨ ID');            } finally {                hideLoading();            }        }        // åŒæ­¥è³‡æ–™åˆ° Google Sheets        async function syncToGoogleSheets(complaintData) {            if (!googleSheetsConfig.apiKey || !googleSheetsConfig.sheetId) {                return false;            }                        try {                const rowData = [                    complaintData.id.toString().padStart(4, '0'),                    new Date(complaintData.submitDate).toLocaleString('zh-TW'),                    complaintData.customerName,                    complaintData.customerPhone,                    complaintData.customerEmail || '',                    complaintData.licensePlate,                    getComplaintTypeText(complaintData.complaintType),                    complaintData.incidentDate,                    complaintData.description,                    getStatusText(complaintData.status),                    (complaintData.images ? complaintData.images.length : 0).toString()                ];                                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${googleSheetsConfig.sheetId}/values/A:K:append?valueInputOption=USER_ENTERED&key=${googleSheetsConfig.apiKey}`, {                    method: 'POST',                    headers: {                        'Content-Type': 'application/json'                    },                    body: JSON.stringify({                        values: [rowData]                    })                });                                return response.ok;            } catch (error) {                console.error('åŒæ­¥åˆ° Google Sheets å¤±æ•—:', error);                return false;            }        }        // å¾ Google Sheets åŒæ­¥è³‡æ–™        async function syncFromCloud() {            if (!googleSheetsConfig.apiKey || !googleSheetsConfig.sheetId) {                alert('è«‹å…ˆè¨­å®š Google Sheets API é‡‘é‘°å’Œè©¦ç®—è¡¨ ID');                return;            }                        showLoading();                        try {                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${googleSheetsConfig.sheetId}/values/A2:K?key=${googleSheetsConfig.apiKey}`);                                if (response.ok) {                    const data = await response.json();                    if (data.values && data.values.length > 0) {                        complaints = data.values.map((row, index) => ({                            id: parseInt(row[0]) || index + 1,                            submitDate: row[1] || new Date().toISOString(),                            customerName: row[2] || '',                            customerPhone: row[3] || '',                            customerEmail: row[4] || '',                            licensePlate: row[5] || '',                            complaintType: getComplaintTypeValue(row[6]) || 'other',                            incidentDate: row[7] || '',                            description: row[8] || '',                            status: getStatusValue(row[9]) || 'pending',                            images: []                        }));                                                localStorage.setItem('complaints_backup', JSON.stringify(complaints));                        loadComplaintList();                        updateStats();                        showMessage('success', `âœ… æˆåŠŸåŒæ­¥ ${complaints.length} ç­†è³‡æ–™ï¼`);                    } else {                        showMessage('info', 'ğŸ“‹ é›²ç«¯æš«ç„¡è³‡æ–™');                    }                } else {                    throw new Error('åŒæ­¥å¤±æ•—');                }            } catch (error) {                console.error('åŒæ­¥éŒ¯èª¤:', error);                showMessage('error', 'âŒ åŒæ­¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå’Œè¨­å®š');            } finally {                hideLoading();            }        }        // åŒ¯å‡º CSV æª”æ¡ˆ        function exportToCSV() {            if (complaints.length === 0) {                alert('ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡º');                return;            }                        const headers = [                'å®¢è¨´ç·¨è™Ÿ', 'æäº¤æ™‚é–“', 'å®¢æˆ¶å§“å', 'è¯çµ¡é›»è©±', 'é›»å­ä¿¡ç®±',                 'è»Šç‰Œè™Ÿç¢¼', 'å®¢è¨´é¡å‹', 'äº‹ç™¼æ—¥æœŸ', 'å•é¡Œæè¿°', 'è™•ç†ç‹€æ…‹', 'ç…§ç‰‡æ•¸é‡'            ];                        const csvData = complaints.map(complaint => [                complaint.id.toString().padStart(4, '0'),                new Date(complaint.submitDate).toLocaleString('zh-TW'),                complaint.customerName,                complaint.customerPhone,                complaint.customerEmail || '',                complaint.licensePlate,                getComplaintTypeText(complaint.complaintType),                complaint.incidentDate,                `"${complaint.description.replace(/"/g, '""')}"`, // è™•ç†æè¿°ä¸­çš„å¼•è™Ÿ                getStatusText(complaint.status),                (complaint.images ? complaint.images.length : 0)            ]);                        const csvContent = [headers, ...csvData]                .map(row => row.join(','))                .join('\n');                        // åŠ ä¸Š BOM ä»¥æ”¯æ´ä¸­æ–‡            const BOM = '\uFEFF';            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });            const link = document.createElement("a");            const url = URL.createObjectURL(blob);            link.setAttribute("href", url);            link.setAttribute("download", `å®¢è¨´è¨˜éŒ„_${new Date().toISOString().slice(0, 10)}.csv`);            link.style.visibility = 'hidden';            document.body.appendChild(link);            link.click();            document.body.removeChild(link);        }        // ç™»å…¥è™•ç†        function handleLogin(event) {            event.preventDefault();            const username = document.getElementById('admin-username').value;            const password = document.getElementById('admin-password').value;            const loginError = document.getElementById('login-error');                        if (username === adminCredentials.username && password === adminCredentials.password) {                sessionStorage.setItem('adminLoggedIn', 'true');                isAdminLoggedIn = true;                checkAdminLogin();                loginError.style.display = 'none';                // åˆ‡æ›åˆ°å¾Œå°ä»‹é¢å¾Œï¼Œè‡ªå‹•è¼‰å…¥è³‡æ–™                syncFromCloud();            } else {                loginError.style.display = 'block';            }        }        // æª¢æŸ¥ç™»å…¥ç‹€æ…‹ä¸¦åˆ‡æ›ä»‹é¢        function checkAdminLogin() {            const loginContainer = document.getElementById('login-container');            const adminDashboard = document.getElementById('admin-dashboard');                        if (isAdminLoggedIn) {                loginContainer.style.display = 'none';                adminDashboard.style.display = 'block';            } else {                loginContainer.style.display = 'block';                adminDashboard.style.display = 'none';            }        }        // ç™»å‡ºåŠŸèƒ½        function logout() {            sessionStorage.removeItem('adminLoggedIn');            isAdminLoggedIn = false;            checkAdminLogin();            alert('æ‚¨å·²ç™»å‡º');        }        // è¡¨å–®æäº¤è™•ç†        async function handleComplaintSubmit(event) {            event.preventDefault();            showLoading();            const form = event.target;            const newComplaint = {                id: complaintIdCounter++,                customerName: form['customer-name'].value,                customerPhone: form['customer-phone'].value,                customerEmail: form['customer-email'].value,                licensePlate: form['license-plate'].value,                complaintType: form['complaint-type'].value,                incidentDate: form['incident-date'].value,                description: form['description'].value,                submitDate: new Date().toISOString(),                status: 'pending',                images: []            };                        // è®€å–åœ–ç‰‡æª”æ¡ˆä¸¦è½‰æ›ç‚º Base64            const files = document.getElementById('photo-upload').files;            const promises = Array.from(files).map(file => {                return new Promise((resolve, reject) => {                    const reader = new FileReader();                    reader.onload = e => resolve(e.target.result);                    reader.onerror = e => reject(e);                    reader.readAsDataURL(file);                });            });                        try {                newComplaint.images = await Promise.all(promises);                complaints.push(newComplaint);                localStorage.setItem('complaints_backup', JSON.stringify(complaints));                localStorage.setItem('complaintIdCounter', complaintIdCounter);                form.reset();                document.getElementById('image-preview').innerHTML = '';                                const success = await syncToGoogleSheets(newComplaint);                                if (success) {                    showMessage('success', 'âœ… æ‚¨çš„å®¢è¨´å·²æˆåŠŸæäº¤è‡³é›²ç«¯ï¼æˆ‘å€‘æœƒç›¡å¿«è™•ç†ä¸¦å›è¦†æ‚¨ã€‚');                } else {                    showMessage('info', 'ğŸ’¡ æ‚¨çš„å®¢è¨´å·²æœ¬åœ°ä¿å­˜ï¼Œä½†æœªèƒ½åŒæ­¥è‡³é›²ç«¯ï¼Œè«‹æª¢æŸ¥è¨­å®šæˆ–ç¶²è·¯ã€‚');                }            } catch (error) {                console.error('åœ–ç‰‡è™•ç†æˆ–æäº¤å¤±æ•—:', error);                showMessage('error', 'âŒ æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚');            } finally {                hideLoading();            }        }        // æª”æ¡ˆä¸Šå‚³é è¦½è™•ç†        function handleFileSelect(event) {            const files = event.target.files;            displayImagePreviews(files);        }        function handleDragOver(event) {            event.preventDefault();            document.querySelector('.file-upload-area').classList.add('dragover');        }        function handleDragLeave(event) {            event.preventDefault();            document.querySelector('.file-upload-area').classList.remove('dragover');        }        function handleDrop(event) {            event.preventDefault();            document.querySelector('.file-upload-area').classList.remove('dragover');            const files = event.dataTransfer.files;            document.getElementById('photo-upload').files = files; // å°‡æ‹–æ›³çš„æª”æ¡ˆè³¦äºˆ input            displayImagePreviews(files);        }        function displayImagePreviews(files) {            const previewContainer = document.getElementById('image-preview');            previewContainer.innerHTML = '';            if (files) {                Array.from(files).forEach(file => {                    if (file.type.startsWith('image/')) {                        const reader = new FileReader();                        reader.onload = e => {                            const img = document.createElement('img');                            img.src = e.target.result;                            previewContainer.appendChild(img);                        };                        reader.readAsDataURL(file);                    }                });            }        }        // è¼‰å…¥å®¢è¨´åˆ—è¡¨åˆ°å¾Œå°        function loadComplaintList() {            if (!isAdminLoggedIn) return;            const listContainer = document.getElementById('complaint-list');            listContainer.innerHTML = '';            if (complaints.length === 0) {                document.getElementById('admin-info-message').style.display = 'block';                return;            }            document.getElementById('admin-info-message').style.display = 'none';            complaints.slice().reverse().forEach(complaint => { // åè½‰ä»¥é¡¯ç¤ºæœ€æ–°æäº¤çš„é …ç›®                const item = document.createElement('div');                item.className = 'complaint-item';                const statusBadge = `<span class="status-badge status-${complaint.status}">${getStatusText(complaint.status)}</span>`;                const typeText = getComplaintTypeText(complaint.complaintType);                item.innerHTML = `                    <div class="complaint-header">                        <span class="complaint-id">#${complaint.id.toString().padStart(4, '0')}</span>                        <span class="complaint-date">${new Date(complaint.submitDate).toLocaleString('zh-TW')}</span>                        ${statusBadge}                    </div>                    <div class="complaint-content">                        <div class="complaint-field">                            <div class="field-label">å®¢æˆ¶å§“å</div>                            <div class="field-value">${complaint.customerName}</div>                        </div>                        <div class="complaint-field">                            <div class="field-label">è¯çµ¡é›»è©±</div>                            <div class="field-value">${complaint.customerPhone}</div>                        </div>                        <div class="complaint-field">                            <div class="field-label">è»Šç‰Œè™Ÿç¢¼</div>                            <div class="field-value">${complaint.licensePlate}</div>                        </div>                        <div class="complaint-field">                            <div class="field-label">å®¢è¨´é¡å‹</div>                            <div class="field-value">${typeText}</div>                        </div>                        <div class="complaint-field" style="grid-column: span 2;">                            <div class="field-label">å•é¡Œæè¿°</div>                            <div class="field-value">${complaint.description}</div>                        </div>                    </div>                    <div id="image-previews-${complaint.id}" class="image-preview"></div>                    <div class="complaint-actions">                        <select onchange="updateStatus(${complaint.id}, this.value)" class="form-control" style="width: auto; flex-grow: 1;">                            <option value="pending" ${complaint.status === 'pending' ? 'selected' : ''}>å¾…è™•ç†</option>                            <option value="processing" ${complaint.status === 'processing' ? 'selected' : ''}>è™•ç†ä¸­</option>                            <option value="resolved" ${complaint.status === 'resolved' ? 'selected' : ''}>å·²è§£æ±º</option>                        </select>                        <button class="btn btn-warning" onclick="editComplaint(${complaint.id})">ç·¨è¼¯</button>                        <button class="btn btn-danger" onclick="deleteComplaint(${complaint.id})">åˆªé™¤</button>                    </div>                `;                listContainer.appendChild(item);                // é¡¯ç¤ºåœ–ç‰‡é è¦½                const imagePreviewContainer = document.getElementById(`image-previews-${complaint.id}`);                if (complaint.images && complaint.images.length > 0) {                    complaint.images.forEach(base64Image => {                        const img = document.createElement('img');                        img.src = base64Image;                        imagePreviewContainer.appendChild(img);                    });                }            });        }        // æ›´æ–°å®¢è¨´ç‹€æ…‹        function updateStatus(id, newStatus) {            const complaintIndex = complaints.findIndex(c => c.id === id);            if (complaintIndex !== -1) {                complaints[complaintIndex].status = newStatus;                localStorage.setItem('complaints_backup', JSON.stringify(complaints));                loadComplaintList();                updateStats();                // æœªä¾†å¯åŠ å…¥åŒæ­¥è‡³é›²ç«¯çš„åŠŸèƒ½            }        }        // åˆªé™¤å®¢è¨´        function deleteComplaint(id) {            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†å®¢è¨´è¨˜éŒ„å—ï¼Ÿ')) {                complaints = complaints.filter(c => c.id !== id);                localStorage.setItem('complaints_backup', JSON.stringify(complaints));                loadComplaintList();                updateStats();                // æœªä¾†å¯åŠ å…¥åŒæ­¥è‡³é›²ç«¯çš„åŠŸèƒ½            }        }        // æ›´æ–°çµ±è¨ˆæ•¸å­—        function updateStats() {            if (!isAdminLoggedIn) return;            const total = complaints.length;            const pending = complaints.filter(c => c.status === 'pending').length;            const processing = complaints.filter(c => c.status === 'processing').length;            const resolved = complaints.filter(c => c.status === 'resolved').length;            document.getElementById('total-complaints').textContent = total;            document.getElementById('pending-complaints').textContent = pending;            document.getElementById('processing-complaints').textContent = processing;            document.getElementById('resolved-complaints').textContent = resolved;        }        // é¡¯ç¤ºè¨Šæ¯æ¡†        function showMessage(type, message) {            const successMsg = document.getElementById('customer-success-message');            const errorMsg = document.getElementById('customer-error-message');            const infoMsg = document.getElementById('admin-info-message');            successMsg.style.display = 'none';            errorMsg.style.display = 'none';            infoMsg.style.display = 'none';                        if (type === 'success') {                successMsg.textContent = message;                successMsg.style.display = 'block';            } else if (type === 'error') {                errorMsg.textContent = message;                errorMsg.style.display = 'block';            } else if (type === 'info') {                infoMsg.textContent = message;                infoMsg.style.display = 'block';            }        }        // è¼”åŠ©å‡½æ•¸ï¼šå–å¾—å®¢è¨´é¡å‹æ–‡å­—        function getComplaintTypeText(value) {            const type = complaintTypes.find(t => t.value === value);            return type ? type.label : value;        }        // è¼”åŠ©å‡½æ•¸ï¼šå–å¾—å®¢è¨´é¡å‹ä»£ç¢¼        function getComplaintTypeValue(label) {            const type = complaintTypes.find(t => t.label === label);            return type ? type.value : label;        }        // è¼”åŠ©å‡½æ•¸ï¼šå–å¾—ç‹€æ…‹æ–‡å­—        function getStatusText(status) {            const statusMap = {                pending: 'å¾…è™•ç†',                processing: 'è™•ç†ä¸­',                resolved: 'å·²è§£æ±º'            };            return statusMap[status] || status;        }        // è¼”åŠ©å‡½æ•¸ï¼šå–å¾—ç‹€æ…‹ä»£ç¢¼        function getStatusValue(statusText) {            const statusMap = {                'å¾…è™•ç†': 'pending',                'è™•ç†ä¸­': 'processing',                'å·²è§£æ±º': 'resolved'            };            return statusMap[statusText] || statusText;        }    </script></body></html>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢è¨´è™•ç†ç³»çµ± - é›²ç«¯ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: bold;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            background: white;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            min-height: 500px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-container, .admin-container {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        .file-upload-area {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            background: #f0f4ff;
        }

        .file-upload-area.dragover {
            border-color: #4c63d2;
            background: #e8efff;
        }

        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .complaint-list {
            display: grid;
            gap: 20px;
        }

        .complaint-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .complaint-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .complaint-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .complaint-id {
            font-weight: bold;
            color: #667eea;
            font-size: 18px;
        }

        .complaint-date {
            color: #6c757d;
            font-size: 14px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: auto;
        }

        .status-pending {
            background: #ffeaa7;
            color: #d63031;
        }

        .status-processing {
            background: #74b9ff;
            color: white;
        }

        .status-resolved {
            background: #00b894;
            color: white;
        }

        .complaint-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .complaint-field {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .field-label {
            font-weight: bold;
            color: #333;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .field-value {
            color: #666;
        }

        .image-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .image-preview img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid #dee2e6;
        }

        .complaint-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .success-message, .error-message, .info-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .info-message {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .config-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .config-section h3 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .type-list {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .type-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-spinner {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .setup-guide {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .complaint-content {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .complaint-actions {
                justify-content: center;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸš— å®¢è¨´è™•ç†ç³»çµ± - é›²ç«¯ç‰ˆ</h1>
            <p>å°ˆæ¥­çš„å®¢æˆ¶æœå‹™ç®¡ç†å¹³å°</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('customer')">å®¢æˆ¶ç”³è¨´</button>
            <button class="nav-tab" onclick="switchTab('admin')">å¾Œå°ç®¡ç†</button>
        </div>

        <!-- å®¢æˆ¶ç”³è¨´è¡¨å–® -->
        <div id="customer-tab" class="tab-content active">
            <div class="form-container">
                <div id="customer-success-message" class="success-message">
                    âœ… æ‚¨çš„å®¢è¨´å·²æˆåŠŸæäº¤è‡³é›²ç«¯ï¼æˆ‘å€‘æœƒç›¡å¿«è™•ç†ä¸¦å›è¦†æ‚¨ã€‚
                </div>

                <div id="customer-error-message" class="error-message">
                    âŒ æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚
                </div>

                <form id="complaint-form">
                    <div class="form-group">
                        <label for="customer-name">å®¢æˆ¶å§“å *</label>
                        <input type="text" id="customer-name" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="customer-phone">è¯çµ¡é›»è©± *</label>
                        <input type="tel" id="customer-phone" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="customer-email">é›»å­ä¿¡ç®±</label>
                        <input type="email" id="customer-email" class="form-control">
                    </div>

                    <div class="form-group">
                        <label for="license-plate">è»Šç‰Œè™Ÿç¢¼ *</label>
                        <input type="text" id="license-plate" class="form-control" placeholder="ä¾‹ï¼šABC-1234" required>
                    </div>

                    <div class="form-group">
                        <label for="complaint-type">å®¢è¨´é¡å‹ *</label>
                        <select id="complaint-type" class="form-control" required>
                            <option value="">è«‹é¸æ“‡å®¢è¨´é¡å‹</option>
                            <!-- å‹•æ…‹è¼‰å…¥é¸é … -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="incident-date">äº‹ç™¼æ—¥æœŸ *</label>
                        <input type="date" id="incident-date" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="description">å•é¡Œæè¿° *</label>
                        <textarea id="description" class="form-control" placeholder="è«‹è©³ç´°æè¿°æ‚¨é‡åˆ°çš„å•é¡Œ..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label>ä¸Šå‚³ç›¸é—œç…§ç‰‡</label>
                        <div class="file-upload-area" onclick="document.getElementById('photo-upload').click()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <div class="upload-icon">ğŸ“·</div>
                            <p><strong>é»æ“Šä¸Šå‚³</strong> æˆ– <strong>æ‹–æ‹½ç…§ç‰‡è‡³æ­¤</strong></p>
                            <p style="font-size: 14px; color: #666; margin-top: 10px;">æ”¯æ´ JPG, PNG æ ¼å¼ï¼Œæœ€å¤§ 5MB</p>
                            <input type="file" id="photo-upload" multiple accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                        </div>
                        <div id="image-preview" class="image-preview"></div>
                    </div>

                    <button type="submit" class="btn btn-primary">â˜ï¸ æäº¤å®¢è¨´è‡³é›²ç«¯</button>
                </form>
            </div>
        </div>

        <!-- å¾Œå°ç®¡ç† -->
        <div id="admin-tab" class="tab-content">
            <!-- ç™»å…¥é é¢ -->
            <div id="login-container" class="admin-container">
                <div style="max-width: 400px; margin: 50px auto; text-align: center;">
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <h2 style="margin-bottom: 10px;">ğŸ” ç®¡ç†å“¡ç™»å…¥</h2>
                        <p>è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼ä»¥å­˜å–å¾Œå°ç®¡ç†</p>
                    </div>
                    
                    <div id="login-error" class="error-message">
                        å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥
                    </div>
                    
                    <form id="login-form" style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <div class="form-group">
                            <label for="admin-username">ç®¡ç†å“¡å¸³è™Ÿ</label>
                            <input type="text" id="admin-username" class="form-control" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-password">å¯†ç¢¼</label>
                            <input type="password" id="admin-password" class="form-control" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å…¥</button>
                    </form>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 5px; font-size: 14px;">
                        <strong>æ¸¬è©¦å¸³è™Ÿï¼š</strong><br>
                        å¸³è™Ÿï¼šadmin<br>
                        å¯†ç¢¼ï¼š123456
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†ä»‹é¢ -->
            <div id="admin-dashboard" class="admin-container" style="display: none;">
                <!-- Google Sheets è¨­å®š -->
                <div class="setup-guide">
                    <h3>âš™ï¸ Google Sheets API è¨­å®š</h3>
                    <p><strong>é‡è¦ï¼š</strong>ä½¿ç”¨é›²ç«¯åŠŸèƒ½å‰ï¼Œè«‹å…ˆè¨­å®š Google Sheets API é‡‘é‘°ï¼š</p>
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="api-key">Google Sheets API é‡‘é‘°</label>
                        <input type="text" id="api-key" class="form-control" placeholder="è«‹è¼¸å…¥æ‚¨çš„ API é‡‘é‘°">
                    </div>
                    <div class="form-group">
                        <label for="sheet-id">Google è©¦ç®—è¡¨ ID</label>
                        <input type="text" id="sheet-id" class="form-control" placeholder="è«‹è¼¸å…¥è©¦ç®—è¡¨ ID">
                    </div>
                    <button class="btn btn-info" onclick="saveGoogleSheetsConfig()">ğŸ’¾ å„²å­˜è¨­å®š</button>
                    <button class="btn btn-success" onclick="initializeSheet()">ğŸš€ åˆå§‹åŒ–è©¦ç®—è¡¨</button>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap;">
                    <h2 style="color: #333;">ğŸ“Š å¾Œå°ç®¡ç†ç³»çµ±</h2>
                    <div>
                        <button class="btn btn-success" onclick="exportToCSV()">ğŸ“Š åŒ¯å‡º CSV</button>
                        <button class="btn btn-info" onclick="syncFromCloud()">â˜ï¸ åŒæ­¥é›²ç«¯è³‡æ–™</button>
                        <button class="btn btn-danger" onclick="logout()">ç™»å‡º</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-complaints">0</div>
                        <div class="stat-label">ç¸½å®¢è¨´æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-complaints">0</div>
                        <div class="stat-label">å¾…è™•ç†</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="processing-complaints">0</div>
                        <div class="stat-label">è™•ç†ä¸­</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="resolved-complaints">0</div>
                        <div class="stat-label">å·²è§£æ±º</div>
                    </div>
                </div>

                <!-- å®¢è¨´é¡å‹ç®¡ç† -->
                <div class="config-section">
                    <h3>ğŸ·ï¸ å®¢è¨´é¡å‹ç®¡ç†</h3>
                    <div class="type-list" id="complaint-types-list">
                        <!-- å‹•æ…‹è¼‰å…¥ -->
                    </div>
                    <div style="display: flex; gap: 10px; align-items: end;">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="new-type-value">é¡å‹ä»£ç¢¼</label>
                            <input type="text" id="new-type-value" class="form-control" placeholder="ä¾‹ï¼šwarranty">
                        </div>
                        <div class="form-group" style="flex: 2; margin-bottom: 0;">
                            <label for="new-type-label">é¡¯ç¤ºåç¨±</label>
                            <input type="text" id="new-type-label" class="form-control" placeholder="ä¾‹ï¼šä¿å›ºç›¸é—œå•é¡Œ">
                        </div>
                        <button class="btn btn-success" onclick="addComplaintType()">â• æ–°å¢é¡å‹</button>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; color: #333;">å®¢è¨´è¨˜éŒ„åˆ—è¡¨</h3>
                <div id="admin-info-message" class="info-message">
                    ğŸ’¡ å¾é›²ç«¯åŒæ­¥è³‡æ–™æˆ–ç­‰å¾…å®¢æˆ¶æäº¤æ–°ç”³è¨´
                </div>
                <div id="complaint-list" class="complaint-list">
                    <!-- å®¢è¨´è¨˜éŒ„æœƒå‹•æ…‹é¡¯ç¤ºåœ¨é€™è£¡ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let complaints = JSON.parse(localStorage.getItem('complaints_backup')) || [];
        let complaintIdCounter = parseInt(localStorage.getItem('complaintIdCounter')) || 1;
        let isAdminLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
        let complaintTypes = JSON.parse(localStorage.getItem('complaintTypes')) || [
            { value: 'service', label: 'æœå‹™å“è³ªå•é¡Œ' },
            { value: 'damage', label: 'è»Šè¼›æå£' },
            { value: 'billing', label: 'è¨ˆè²»çˆ­è­°' },
            { value: 'staff', label: 'å“¡å·¥æœå‹™æ…‹åº¦' },
            { value: 'facility', label: 'è¨­æ–½è¨­å‚™å•é¡Œ' },
            { value: 'safety', label: 'å®‰å…¨ç›¸é—œå•é¡Œ' },
            { value: 'appointment', label: 'é ç´„æ’ç¨‹å•é¡Œ' },
            { value: 'refund', label: 'é€€æ¬¾ç›¸é—œ' },
            { value: 'other', label: 'å…¶ä»–å•é¡Œ' }
        ];

        // Google Sheets è¨­å®š
        let googleSheetsConfig = JSON.parse(localStorage.getItem('googleSheetsConfig')) || {
            apiKey: '',
            sheetId: ''
        };

        // ç®¡ç†å“¡å¸³è™Ÿè¨­å®š
        const adminCredentials = {
            username: 'admin',
            password: '123456'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminLogin();
            loadComplaintTypes();
            updateComplaintTypesList();
            loadComplaintList();
            updateStats();
            
            // è¼‰å…¥ Google Sheets è¨­å®š
            if (googleSheetsConfig.apiKey && googleSheetsConfig.sheetId) {
                document.getElementById('api-key').value = googleSheetsConfig.apiKey;
                document.getElementById('sheet-id').value = googleSheetsConfig.sheetId;
            }
            
            // ç™»å…¥è¡¨å–®äº‹ä»¶
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            const complaintForm = document.getElementById('complaint-form');
            if (complaintForm) {
                complaintForm.addEventListener('submit', handleComplaintSubmit);
            }
        });

        // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
        function showLoading() {
            document.getElementById('loading-overlay').style.display = 'flex';
        }

        // éš±è—è¼‰å…¥å‹•ç•«
        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
        }

        // åˆ‡æ›é ç±¤
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            if (tabName === 'admin') {
                checkAdminLogin();
                if (isAdminLoggedIn) {
                    loadComplaintList();
                    updateStats();
                    updateComplaintTypesList();
                }
            } else if (tabName === 'customer') {
                loadComplaintTypes();
            }
        }

        // è¼‰å…¥å®¢è¨´é¡å‹åˆ°ä¸‹æ‹‰é¸å–®
        function loadComplaintTypes() {
            const select = document.getElementById('complaint-type');
            select.innerHTML = '<option value="">è«‹é¸æ“‡å®¢è¨´é¡å‹</option>';
            
            complaintTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type.value;
                option.textContent = type.label;
                select.appendChild(option);
            });
        }

        // æ›´æ–°å¾Œå°çš„å®¢è¨´é¡å‹åˆ—è¡¨
        function updateComplaintTypesList() {
            if (!isAdminLoggedIn) return;
            
            const list = document.getElementById('complaint-types-list');
            list.innerHTML = '';
            
            complaintTypes.forEach((type, index) => {
                const item = document.createElement('div');
                item.className = 'type-item';
                item.innerHTML = `
                    <div>
                        <strong>${type.value}</strong> - ${type.label}
                    </div>
                    <button class="btn btn-danger" onclick="removeComplaintType(${index})" style="padding: 5px 10px; margin: 0;">ğŸ—‘ï¸</button>
                `;
                list.appendChild(item);
            });
        }

        // æ–°å¢å®¢è¨´é¡å‹
        function addComplaintType() {
            const value = document.getElementById('new-type-value').value.trim();
            const label = document.getElementById('new-type-label').value.trim();
            
            if (!value || !label) {
                alert('è«‹å¡«å¯«å®Œæ•´çš„é¡å‹ä»£ç¢¼å’Œé¡¯ç¤ºåç¨±');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦é‡è¤‡
            if (complaintTypes.find(type => type.value === value)) {
                alert('é¡å‹ä»£ç¢¼å·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨å…¶ä»–ä»£ç¢¼');
                return;
            }
            
            complaintTypes.push({ value, label });
            localStorage.setItem('complaintTypes', JSON.stringify(complaintTypes));
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('new-type-value').value = '';
            document.getElementById('new-type-label').value = '';
            
            // æ›´æ–°é¡¯ç¤º
            updateComplaintTypesList();
            loadComplaintTypes();
        }

        // åˆªé™¤å®¢è¨´é¡å‹
        function removeComplaintType(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å®¢è¨´é¡å‹å—ï¼Ÿ')) {
                complaintTypes.splice(index, 1);
                localStorage.setItem('complaintTypes', JSON.stringify(complaintTypes));
                updateComplaintTypesList();
                loadComplaintTypes();
            }
        }

        // å„²å­˜ Google Sheets è¨­å®š
        function saveGoogleSheetsConfig() {
            const apiKey = document.getElementById('api-key').value.trim();
            const sheetId = document.getElementById('sheet-id').value.trim();
            
            if (!apiKey || !sheetId) {
                alert('è«‹å¡«å¯«å®Œæ•´çš„ API é‡‘é‘°å’Œè©¦ç®—è¡¨ ID');
                return;
            }
            
            googleSheetsConfig = { apiKey, sheetId };
            localStorage.setItem('googleSheetsConfig', JSON.stringify(googleSheetsConfig));
            
            showMessage('success', 'âœ… Google Sheets è¨­å®šå·²å„²å­˜ï¼');
        }

        // åˆå§‹åŒ– Google Sheets
        async function initializeSheet() {
            if (!googleSheetsConfig.apiKey || !googleSheetsConfig.sheetId) {
                alert('è«‹å…ˆè¨­å®š API é‡‘é‘°å’Œè©¦ç®—è¡¨ ID');
                return;
            }
            
            showLoading();
            
            try {
                // è¨­å®šæ¨™é¡Œåˆ—
                const headers = [
                    'å®¢è¨´ç·¨è™Ÿ', 'æäº¤æ™‚é–“', 'å®¢æˆ¶å§“å', 'è¯çµ¡é›»è©±', 'é›»å­ä¿¡ç®±', 
                    'è»Šç‰Œè™Ÿç¢¼', 'å®¢è¨´é¡å‹', 'äº‹ç™¼æ—¥æœŸ', 'å•é¡Œæè¿°', 'è™•ç†ç‹€æ…‹', 'ç…§ç‰‡æ•¸é‡'
                ];
                
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${googleSheetsConfig.sheetId}/values/A1:K1?key=${googleSheetsConfig.apiKey}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        values: [headers]
                    })
                });
                
                if (response.ok) {
                    showMessage('success', 'âœ… Google Sheets åˆå§‹åŒ–æˆåŠŸï¼');
                } else {
                    throw new Error('åˆå§‹åŒ–å¤±æ•—');
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–éŒ¯èª¤:', error);
                showMessage('error', 'âŒ åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API é‡‘é‘°å’Œè©¦ç®—è¡¨ ID');
            } finally {
                hideLoading();
            }
        }

        // åŒæ­¥è³‡æ–™åˆ° Google Sheets
        async function syncToGoogleSheets(complaintData) {
            if (!googleSheetsConfig.apiKey || !googleSheetsConfig.sheetId) {
                return false;
            }
            
            try {
                const rowData = [
                    complaintData.id.toString().padStart(4, '0'),
                    new Date(complaintData.submitDate).toLocaleString('zh-TW'),
                    complaintData.customerName,
                    complaintData.customerPhone,
                    complaintData.customerEmail || '',
                    complaintData.licensePlate,
                    getComplaintTypeText(complaintData.complaintType),
                    complaintData.incidentDate,
                    complaintData.description,
                    getStatusText(complaintData.status),
                    (complaintData.images ? complaintData.images.length : 0).toString()
                ];
                
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${googleSheetsConfig.sheetId}/values/A:K:append?valueInputOption=USER_ENTERED&key=${googleSheetsConfig.apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        values: [rowData]
                    })
                });
                
                return response.ok;
            } catch (error) {
                console.error('åŒæ­¥åˆ° Google Sheets å¤±æ•—:', error);
                return false;
            }
        }

        // å¾ Google Sheets åŒæ­¥è³‡æ–™
        async function syncFromCloud() {
            if (!googleSheetsConfig.apiKey || !googleSheetsConfig.sheetId) {
                alert('è«‹å…ˆè¨­å®š Google Sheets API é‡‘é‘°å’Œè©¦ç®—è¡¨ ID');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${googleSheetsConfig.sheetId}/values/A2:K?key=${googleSheetsConfig.apiKey}`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.values && data.values.length > 0) {
                        complaints = data.values.map((row, index) => ({
                            id: parseInt(row[0]) || index + 1,
                            submitDate: row[1] || new Date().toISOString(),
                            customerName: row[2] || '',
                            customerPhone: row[3] || '',
                            customerEmail: row[4] || '',
                            licensePlate: row[5] || '',
                            complaintType: getComplaintTypeValue(row[6]) || 'other',
                            incidentDate: row[7] || '',
                            description: row[8] || '',
                            status: getStatusValue(row[9]) || 'pending',
                            images: []
                        }));
                        
                        localStorage.setItem('complaints_backup', JSON.stringify(complaints));
                        loadComplaintList();
                        updateStats();
                        showMessage('success', `âœ… æˆåŠŸåŒæ­¥ ${complaints.length} ç­†è³‡æ–™ï¼`);
                    } else {
                        showMessage('info', 'ğŸ“‹ é›²ç«¯æš«ç„¡è³‡æ–™');
                    }
                } else {
                    throw new Error('åŒæ­¥å¤±æ•—');
                }
            } catch (error) {
                console.error('åŒæ­¥éŒ¯èª¤:', error);
                showMessage('error', 'âŒ åŒæ­¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå’Œè¨­å®š');
            } finally {
                hideLoading();
            }
        }

        // åŒ¯å‡º CSV æª”æ¡ˆ
        function exportToCSV() {
            if (complaints.length === 0) {
                alert('ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡º');
                return;
            }
            
            const headers = [
                'å®¢è¨´ç·¨è™Ÿ', 'æäº¤æ™‚é–“', 'å®¢æˆ¶å§“å', 'è¯çµ¡é›»è©±', 'é›»å­ä¿¡ç®±', 
                'è»Šç‰Œè™Ÿç¢¼', 'å®¢è¨´é¡å‹', 'äº‹ç™¼æ—¥æœŸ', 'å•é¡Œæè¿°', 'è™•ç†ç‹€æ…‹', 'ç…§ç‰‡æ•¸é‡'
            ];
            
            const csvData = complaints.map(complaint => [
                complaint.id.toString().padStart(4, '0'),
                new Date(complaint.submitDate).toLocaleString('zh-TW'),
                complaint.customerName,
                complaint.customerPhone,
                complaint.customerEmail || '',
                complaint.licensePlate,
                getComplaintTypeText(complaint.complaintType),
                complaint.incidentDate,
                `"${complaint.description.replace(/"/g, '""')}"`, // è™•ç†æè¿°ä¸­çš„å¼•è™Ÿ
                getStatusText(complaint.status),
                (complaint.images ? complaint.images.length : 0)
            ]);
            
            const csvContent = [headers, ...csvData]
                .map(row => row.join(','))
                .join('\n');
            
            // åŠ ä¸Š BOM ä»¥æ”¯æ´ä¸­æ–‡
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `å®¢è¨´è³‡æ–™_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showMessage('success', 'ğŸ“Š CSV æª”æ¡ˆåŒ¯å‡ºæˆåŠŸï¼');
        }

        // æª¢æŸ¥ç®¡ç†å“¡ç™»å…¥ç‹€æ…‹
        function checkAdminLogin() {
            if (isAdminLoggedIn) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
            } else {
                document.getElementById('login-container').style.display = 'block';
                document.getElementById('admin-dashboard').style.display = 'none';
            }
        }

        // è™•ç†ç™»å…¥
        function handleLogin(e) {
            e.preventDefault();
            console.log('ç™»å…¥å˜—è©¦é–‹å§‹');
            
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            console.log('å¸³è™Ÿ:', username, 'å¯†ç¢¼:', password);
            console.log('æ­£ç¢ºå¸³è™Ÿ:', adminCredentials.username, 'æ­£ç¢ºå¯†ç¢¼:', adminCredentials.password);
            
            if (username === adminCredentials.username && password === adminCredentials.password) {
                console.log('ç™»å…¥æˆåŠŸ');
                isAdminLoggedIn = true;
                sessionStorage.setItem('adminLoggedIn', 'true');
                
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                document.getElementById('login-error').style.display = 'none';
                
                loadComplaintList();
                updateStats();
                updateComplaintTypesList();
                
                document.getElementById('login-form').reset();
                showMessage('info', 'âœ… ç™»å…¥æˆåŠŸï¼');
            } else {
                console.log('ç™»å…¥å¤±æ•—');
                document.getElementById('login-error').style.display = 'block';
                document.getElementById('admin-password').value = '';
                showMessage('error', 'âŒ å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
            }
        }

        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                isAdminLoggedIn = false;
                sessionStorage.removeItem('adminLoggedIn');
                
                document.getElementById('login-container').style.display = 'block';
                document.getElementById('admin-dashboard').style.display = 'none';
                document.getElementById('login-form').reset();
                document.getElementById('login-error').style.display = 'none';
            }
        }

        // è™•ç†æª”æ¡ˆé¸æ“‡
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            displayImages(files);
        }

        // è™•ç†æ‹–æ‹½
        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            event.target.closest('.file-upload-area').classList.remove('dragover');
            
            const files = Array.from(event.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            displayImages(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.target.closest('.file-upload-area').classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.target.closest('.file-upload-area').classList.remove('dragover');
        }

        // é¡¯ç¤ºåœ–ç‰‡é è¦½
        function displayImages(files) {
            const preview = document.getElementById('image-preview');
            
            files.forEach(file => {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`æª”æ¡ˆ ${file.name} å¤§å°è¶…é 5MBï¼Œè«‹é‡æ–°é¸æ“‡ã€‚`);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.title = file.name;
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }

        // è¡¨å–®æäº¤
        async function handleComplaintSubmit(e) {
            e.preventDefault();
            
            showLoading();
            
            const formData = {
                id: complaintIdCounter++,
                customerName: document.getElementById('customer-name').value,
                customerPhone: document.getElementById('customer-phone').value,
                customerEmail: document.getElementById('customer-email').value,
                licensePlate: document.getElementById('license-plate').value,
                complaintType: document.getElementById('complaint-type').value,
                incidentDate: document.getElementById('incident-date').value,
                description: document.getElementById('description').value,
                images: Array.from(document.getElementById('image-preview').querySelectorAll('img')).map(img => img.src),
                submitDate: new Date().toISOString(),
                status: 'pending'
            };
            
            // å„²å­˜åˆ°æœ¬æ©Ÿå‚™ä»½
            complaints.push(formData);
            localStorage.setItem('complaints_backup', JSON.stringify(complaints));
            localStorage.setItem('complaintIdCounter', complaintIdCounter.toString());
            
            // å˜—è©¦åŒæ­¥åˆ° Google Sheets
            const syncSuccess = await syncToGoogleSheets(formData);
            
            hideLoading();
            
            if (syncSuccess) {
                showMessage('customer-success', 'âœ… æ‚¨çš„å®¢è¨´å·²æˆåŠŸæäº¤è‡³é›²ç«¯ï¼æˆ‘å€‘æœƒç›¡å¿«è™•ç†ä¸¦å›è¦†æ‚¨ã€‚');
            } else {
                showMessage('customer-success', 'âœ… æ‚¨çš„å®¢è¨´å·²æˆåŠŸæäº¤ï¼æˆ‘å€‘æœƒç›¡å¿«è™•ç†ä¸¦å›è¦†æ‚¨ã€‚');
                console.log('é›²ç«¯åŒæ­¥å¤±æ•—ï¼Œè³‡æ–™å·²å„²å­˜åœ¨æœ¬æ©Ÿå‚™ä»½');
            }
            
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('complaint-form').reset();
            document.getElementById('image-preview').innerHTML = '';
            
            // æ»¾å‹•åˆ°é ‚éƒ¨
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(type, message) {
            const messageElement = document.getElementById(type + '-message') || document.getElementById(type);
            if (messageElement) {
                messageElement.textContent = message;
                messageElement.style.display = 'block';
                
                setTimeout(() => {
                    messageElement.style.display = 'none';
                }, 5000);
            }
        }

        // è¼‰å…¥å®¢è¨´åˆ—è¡¨
        function loadComplaintList() {
            if (!isAdminLoggedIn) return;
            
            const list = document.getElementById('complaint-list');
            list.innerHTML = '';
            
            if (complaints.length === 0) {
                document.getElementById('admin-info-message').style.display = 'block';
                return;
            } else {
                document.getElementById('admin-info-message').style.display = 'none';
            }
            
            complaints.sort((a, b) => new Date(b.submitDate) - new Date(a.submitDate)).forEach(complaint => {
                const item = createComplaintItem(complaint);
                list.appendChild(item);
            });
        }

        // å»ºç«‹å®¢è¨´é …ç›®
        function createComplaintItem(complaint) {
            const item = document.createElement('div');
            item.className = 'complaint-item';
            
            const statusClass = `status-${complaint.status}`;
            const statusText = getStatusText(complaint.status);
            const complaintTypeText = getComplaintTypeText(complaint.complaintType);
            
            item.innerHTML = `
                <div class="complaint-header">
                    <div>
                        <div class="complaint-id">å®¢è¨´ç·¨è™Ÿ: #${complaint.id.toString().padStart(4, '0')}</div>
                        <div class="complaint-date">${new Date(complaint.submitDate).toLocaleString('zh-TW')}</div>
                    </div>
                    <div class="status-badge ${statusClass}">${statusText}</div>
                </div>
                
                <div class="complaint-content">
                    <div class="complaint-field">
                        <div class="field-label">å®¢æˆ¶å§“å</div>
                        <div class="field-value">${complaint.customerName}</div>
                    </div>
                    <div class="complaint-field">
                        <div class="field-label">è¯çµ¡é›»è©±</div>
                        <div class="field-value">${complaint.customerPhone}</div>
                    </div>
                    <div class="complaint-field">
                        <div class="field-label">è»Šç‰Œè™Ÿç¢¼</div>
                        <div class="field-value">${complaint.licensePlate}</div>
                    </div>
                    <div class="complaint-field">
                        <div class="field-label">å®¢è¨´é¡å‹</div>
                        <div class="field-value">${complaintTypeText}</div>
                    </div>
                    <div class="complaint-field">
                        <div class="field-label">äº‹ç™¼æ—¥æœŸ</div>
                        <div class="field-value">${complaint.incidentDate}</div>
                    </div>
                    <div class="complaint-field">
                        <div class="field-label">é›»å­ä¿¡ç®±</div>
                        <div class="field-value">${complaint.customerEmail || 'æœªæä¾›'}</div>
                    </div>
                </div>
                
                <div class="complaint-field">
                    <div class="field-label">å•é¡Œæè¿°</div>
                    <div class="field-value">${complaint.description}</div>
                    ${complaint.images && complaint.images.length > 0 ? `
                        <div class="image-preview">
                            ${complaint.images.map(img => `<img src="${img}" alt="å®¢è¨´ç…§ç‰‡">`).join('')}
                        </div>
                    ` : ''}
                </div>
                
                <div class="complaint-actions">
                    ${complaint.status === 'pending' ? `<button class="btn btn-primary" onclick="updateStatus(${complaint.id}, 'processing')">é–‹å§‹è™•ç†</button>` : ''}
                    ${complaint.status === 'processing' ? `<button class="btn btn-primary" onclick="updateStatus(${complaint.id}, 'resolved')">æ¨™è¨˜ç‚ºå·²è§£æ±º</button>` : ''}
                    <button class="btn btn-danger" onclick="deleteComplaint(${complaint.id})">åˆªé™¤</button>
                </div>
            `;
            
            return item;
        }

        // æ›´æ–°ç‹€æ…‹
        function updateStatus(id, status) {
            const complaint = complaints.find(c => c.id === id);
            if (complaint) {
                complaint.status = status;
                localStorage.setItem('complaints_backup', JSON.stringify(complaints));
                loadComplaintList();
                updateStats();
                
                // å¯ä»¥åœ¨é€™è£¡åŠ å…¥æ›´æ–° Google Sheets çš„é‚è¼¯
                showMessage('info', 'âœ… ç‹€æ…‹å·²æ›´æ–°');
            }
        }

        // åˆªé™¤å®¢è¨´
        function deleteComplaint(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†å®¢è¨´è¨˜éŒ„å—ï¼Ÿ')) {
                complaints = complaints.filter(c => c.id !== id);
                localStorage.setItem('complaints_backup', JSON.stringify(complaints));
                loadComplaintList();
                updateStats();
                showMessage('info', 'ğŸ—‘ï¸ è¨˜éŒ„å·²åˆªé™¤');
            }
        }

        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats() {
            if (!isAdminLoggedIn) return;
            
            const total = complaints.length;
            const pending = complaints.filter(c => c.status === 'pending').length;
            const processing = complaints.filter(c => c.status === 'processing').length;
            const resolved = complaints.filter(c => c.status === 'resolved').length;
            
            document.getElementById('total-complaints').textContent = total;
            document.getElementById('pending-complaints').textContent = pending;
            document.getElementById('processing-complaints').textContent = processing;
            document.getElementById('resolved-complaints').textContent = resolved;
        }

        // è¼”åŠ©å‡½æ•¸
        function getStatusText(status) {
            const statusMap = {
                'pending': 'å¾…è™•ç†',
                'processing': 'è™•ç†ä¸­',
                'resolved': 'å·²è§£æ±º'
            };
            return statusMap[status] || status;
        }

        function getStatusValue(statusText) {
            const statusMap = {
                'å¾…è™•ç†': 'pending',
                'è™•ç†ä¸­': 'processing',
                'å·²è§£æ±º': 'resolved'
            };
            return statusMap[statusText] || 'pending';
        }

        function getComplaintTypeText(type) {
            const foundType = complaintTypes.find(t => t.value === type);
            return foundType ? foundType.label : type;
        }

        function getComplaintTypeValue(typeText) {
            const foundType = complaintTypes.find(t => t.label === typeText);
            return foundType ? foundType.value : 'other';
        }
    </script>
</body>
</html>
